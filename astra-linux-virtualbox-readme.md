# Установка Astra Linux 1.10 в VirtualBox

### Подготовка к установке

Скачиваем образ операционной системы по [ссылке](ftp://mirror.yandex.ru/astra/current/orel/iso/). 

Запускаем VirtualBox. Создаем новую машину со следующими характеристиками: тип - Linux, версия - Debian (64 бит), RAM - 4096 МБ, жесткий диск - "создать новый...", тип жесткого диска - VDI, формат хранения - динамический, размер - 8 ГБ. 

После того, как машина будет создана выбираем "Настроить". В окне настроек переходим на вкладку "Дисплей" и устанавливаем следующие параметры: видеопамять - 128 МБ, ускорение - "включить 3D-ускорение". Переходим на вкладку "Носители", в поле "Носители информации" выбираем поле со значком CD-R и надписью "Пусто" и в поле "Атрибуты" выбираем образ загруженного диска. Нажимаем "ОК". Окно настроек закроется.

### Установка

Запускаем машину (кнопка "Запустить" на пенели инструментов). Выбираем язык установки и графический режим. Далее принимаем условия лицензионного соглашения. Потом вводим: имя компьютера, имя пользователя, имя учетной записи, пароль, часовой пояс. Размечаем диск - везде выбираем значения по-умолчанию. 

На следующем этапе устновки небходимо выбрать дополнительное программное обеспечение. Здесь также можно оставить значения по-умолчанию.

Система начинает установку пакетов. После установки необходимо выбрать загрузчик. Всё по-умолчанию. Система перезагрузится по завершению установки.

Подробная инструкция по установке ОС приведена [здесь](http://www.astra-linux.com/images/doc/AstraLinuxCE_install.pdf).

### Настройка

##### Разрешение экрана

Первое, что необходимо сделать - установить нормальное разрешение экрана. Это (и многое другое) делается посредствам установки дополнений операционной системы.

Монтируем образ установочного диска. Для этого на статусной панели окна виртуальной машины (внизу) нажимаем правой кнопкой мыши на значок привода оптический дисков и в конекстном меню выбираем наш установочный образ.

Запускаем терминал (нажимаем `Alt+F2` и в окне "Выполнить команду" вводим `fly-term`)

    $ sudo apt-get install linux-headers-$(uname -r) make

После завершения установки отключаем установочный диск аналогичным образом.

Переходим в меню окна виртуальном машины "Устройства" - "Подключить образ диска Дополнений...". В трее нажимаем на появившийся значек диска и нажимаем кнопку "Монтировать".

В терминале переходим в директорию диска и запускаем установку дополнений ОС.

    $ cd /media/cdrom
    $ sudo sh ./VBoxLinuxAdditions.run
    $ sudo reboot

Если в процессе установки дополнений имела место быть ошибка, то можно посмотреть в файл `/var/log/vboxadd-install.log`.

После перезагрузки, если всё прошло удачно, мы можем изменять размер окна виртуальной машины и разрешение будет подстраиваться под заданный размер.

##### Автоматический вход

Для того, чтобы не вводить пароль всякий раз при загрузке можно установить автоматический вход. Для этого переходим в "Стартовое меню" - "Настройки" - "Вход в систему". В появившемся окне "Настройка графического входа" переходим на вкладку "Дополнительно" и активируем поле "Разрешить автоматический вход в систему" и указываем пользователя. 

Здесь же можно установить опцию "Заблокировать сеанс" чтобы не происходила автоматическая блокировка рабочего стола.

##### Конфигурация репозиториев

По-умолчанию программы (через `apt-get`) устанавливаются с установчного диска. На официальном [сайте](http://www.astra-linux.ru/nastrojka-apt.html) можно найти рекомендации по настройке системы `apt` для работы с репозиторием.

В файл `/etc/apt/source.list` добавляем следующием строки:
```
deb ftp://ftp.astra-linux.com/astra/frozen/orel/1.10/repository orel main contrib non-free
deb-src ftp://ftp.astra-linux.com/astra/frozen/orel/1.10/repository orel main contrib non-free
deb ftp://ftp.astra-linux.com/astra/current/orel/repository orel main contrib non-free
deb-src ftp://ftp.astra-linux.com/astra/current/orel/repository orel main contrib non-free
```

В терминале выполняем

    $ sudo apt-get update
    $ sudo apt-get dist-upgrade


### Установка средств разработки 

##### Редактор Sublime text 2

Скачиваем архив по ссылке http://www.sublimetext.com/2 и выполняем следующие команды

	$ sudo mv Sublime\ Text\ 2/ /opt/sublime-text-2/
	$ sudo ln -s /opt/sublime-text-2 /usr/local/subl
	$ sudo ln -s /usr/local/sublime-text-2/sublime_text /usr/local/bin/subl
	$ rm Sublime\ Text\ 2*.tar.bz2

Устанавливаем Page Control как ([ссылка](https://packagecontrol.io/installation)).

Если `Page Control:Install Package` не работает:
1.	Скачиваем архив по [ссылке](https://github.com/DamnWidget/SublimePySide)
2.	Распаковываем в директорию `/home/<username>/.config/sublime-text-2/Packages`
3.	Перезапускаем `Sublime`




##### Qt5 и Python3

Запускаем менеджер пакетов Synaptic и выделяем следующие пакеты для установки: pyqthon3-pyqt5, pyqt5-dev, pyqt5-doc, qmlscene. Нажимаем кнопку "Обновить".

В терминале задаем переменную окружения

    $ export LIBGL_ALWAYS_SOFTWARE=1

Проверяем корректность QML

    $ qmlscene /usr/lib/x86_64-linux-gnu/qt5/qml/QtQuick/Controls/Calendar.qml

В qmlscene будет календарь.

Теперь надо проверить связку `Python`, `Qt` и `QML`. Создаем файл `main.py` следующего содержания

```python
mport sys
from PyQt5.QtCore import QUrl
from PyQt5.QtWidgets import QApplication
from PyQt5.QtQuick import QQuickView

# Main Function
if __name__ == '__main__':
    # Create main app
    myApp = QApplication(sys.argv)
    # Create a label and set its properties
    appLabel = QQuickView()
    appLabel.setSource(QUrl('/usr/lib/x86_64-linux-gnu/qt5/qml/QtQuick/Controls/Calendar.qml'))

    # Show the Label
    appLabel.show()

    # Execute the Application and Exit
    myApp.exec_()
    sys.exit()
```

Запускаем его командой:

    $ python3 main.py

В окошке должен отобразиться календарик.
